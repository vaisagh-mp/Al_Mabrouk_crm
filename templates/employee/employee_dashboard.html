{% extends 'employee/employeebase.html' %}
{% load custom_filters %}
{% load static %}
{% block content %}

<div class="dashbrd-wraper">
    <div class="pg-title">
        <h1>Dashboard</h1>
    </div>
    <!-- TATP -->
    <div class="row status-card-row">
        <div class="col-lg-3 col-md-6">
            <div class="status-wdgt card-bg-green">
                <h5>Total Projects</h5>
                <h6>{{ total_projects }}</h6>
                <p>
                    <i class="fas fa-arrow-up"></i> <span>10%</span> Since last
                    month
                </p>

                <div class="wdgt-bg-icons"><i class="fas fa-list"></i></div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="status-wdgt card-bg-blue">
                <h5>Pending Projects</h5>
                <h6>{{ pending_projects }}</h6>
                <p>
                    <i class="fas fa-arrow-up"></i> <span>8%</span> Since last month
                </p>

                <div class="wdgt-bg-icons"><i class="fas fa-spinner"></i></div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="status-wdgt card-bg-violet">
                <h5>Completed Projects</h5>
                <h6>{{ completed_projects }}</h6>
                <p>
                    <i class="fas fa-arrow-up"></i> <span>26%</span> Since last
                    month
                </p>

                <div class="wdgt-bg-icons">
                    <i class="fas fa-tasks"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 m-b-20">
            <div class="status-wdgt card-bg-orange">
                <h5>Attendance</h5>
                <h6>{{ attendance_percentage|floatformat:0 }}%</h6>
                <p>
                    <i class="fas fa-arrow-up"></i> <span>5%</span> Since last month
                </p>

                <div class="wdgt-bg-icons"><i class="fas fa-percentage"></i></div>
            </div>
        </div>
    </div>
    <!-- End TATP -->
    <div class="row mt-4 mb-4">
        <!-- Punch In Card -->
        <div class="col-lg-4 col-md-6">
            <div class="widget-box">
                <div class="attendance-card">
                    <h3>Attendance</h3>
                    <div class="date">08:35 AM, 11 Mar 2025</div>
                    <div id="Puncinchart"></div>

                    <div class="info">
                        <img src="{% static 'assets/images/fingerprint.png' %}" alt="Punch In"> Punch In at <span>10:00 AM</span>
                    </div>
                    <a href="{% url 'attendance_dashboard' %}" id="punchIn" onclick="startTimer()">Punch In</a>
                </div>
            </div>
        </div>
        <!-- Leave Details Card -->
        <div class="col-lg-4 col-md-6">
            <div class="widget-box leave-card-widget">
                <div class="leave-card">
                    <button class="year-btn">2024</button>
                    <div class="widget-title">
                        <h4>Leave Details</h4>
                    </div>
                    <div class="leave-details">
                        <div>
                            <span class="label">Total Leaves</span>
                            <span class="value">16</span>
                        </div>
                        <div>
                            <span class="label">Taken</span>
                            <span class="value">10</span>
                        </div>
                        <div>
                            <span class="label">Absent</span>
                            <span class="value">2</span>
                        </div>
                        <div>
                            <span class="label">Request</span>
                            <span class="value">0</span>
                        </div>
                        <div>
                            <span class="label">Worked Days</span>
                            <span class="value">240</span>
                        </div>
                        <div>
                            <span class="label">Loss of Pay</span>
                            <span class="value">2</span>
                        </div>
                    </div>
                    <div class="aply-lv-btn"><a href="{% url 'apply_leave' %}" class="apply-btn">Apply New Leave</a></div>

                </div>
            </div>
        </div>
        <!-- Leave Details Chart Card -->
        <div class="col-lg-4 col-md-6 lv-chrt-col">
            <div class="widget-box leave-card-widget">
                <div class="widget-title">
                    <h4>Leave Details</h4>
                </div>
                <div id="leaveChart"></div>
            </div>
        </div>

        <!-- Project Table -->
        <div class="widget-box mt-4 table-wdgt">
            <div class="widget-title">
                <h4>Assigned Projects</h4>
            </div>
            <table class="prjtc-table">
                <thead>
                    <tr>
                        <th>Project</th>
                        <th>Team</th>
                        <th>Leader</th>
                        <th>Priority</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for work in assigned_work %}
                    <tr>
                        <td>
                            <a href="{% url 'project_details' work.team.project.id %}">
                                {{ work.team.project.name }}
                            </a>
                        </td>
                        <td>
                            <div class="avatars" style="width: max-content; margin: auto;">
                                {% for member in work.team.employees.all %}
                                    <img src="{% static 'assets/images/user-pro.webp' %}" alt="{{ member.user.username }}" />
                                {% endfor %}
                                <span>+{{ work.team.employees.count }}</span>
                            </div>
                        </td>
                        <td>{{ work.team.manager.user.username }}</td>
                        <td>
                            <span class="priority {% if work.team.project.category == 'ANCHORAGE' %}high{% else %}medium{% endif %}">
                                {% if work.team.project.category == 'ANCHORAGE' %}
                                    High
                                {% else %}
                                    Medium
                                {% endif %}
                            </span>
                        </td>
                        
                        <td>
                            <span class="status Assign">{{ work.get_status_display }}</span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center;">No projects assigned</td>
                    </tr>
                    {% endfor %}
                </tbody>
                            
            </table>
        </div>
    </div>
</div>

{% endblock %}