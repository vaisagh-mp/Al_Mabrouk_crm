{% extends 'employee/employeebase.html' %}
{% block content %}

<style>
  .table-responsive {
  width: 100%;
  overflow-x: auto;
}

.table-responsive table {
  width: 100%;
  min-width: 500px; /* Or whatever minimum width your table requires */
  border-collapse: collapse;
}

.table-responsive th,
.table-responsive td {
  white-space: nowrap;
  padding: 8px;
  text-align: left;
}

</style>

<h2>Update Work Order: {{ work_order.work_order_number }}</h2>

<div class="wrk-rprt-frm">
  <form id="workOrderForm" method="post" enctype="multipart/form-data">{% csrf_token %}
    <div>
      <label>Spares Required</label>
      <div class="table-responsive">
        <table id="sparesTable">
        <thead>
        <tr>
          <th>Spare Name</th>
          <th>Unit</th>
          <th>Quantity</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
      </div>
      
      <button type="button" class="add-btn" onclick="addSpareRow()">Add Spare</button>
    </div>

    <div class="wr-ordr-tbl">
  <label>Spares Consumed</label>
  <div class="table-responsive">
    <table id="sparesConsumedTable">
      <thead>
        <tr>
          <th>Spare Name</th>
          <th>Unit</th>
          <th>Quantity</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <button
    type="button"
    class="add-btn"
    onclick="addSpareConsumedRow()"
  >
    Add Consumed Spare
  </button>
</div>

    <div>
      <label>Tools Required</label>
      <div class="table-responsive">
        <table id="toolsTable">
        <thead>
        <tr>
          <th>Tool Name</th>
          <th>Quantity</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
      </div>
      
      <button type="button" class="add-btn" onclick="addToolRow()">Add Tool</button>
    </div>

    <div>
      <label>Documents</label>
      <div class="table-responsive">
        <table id="docsTable">
        <thead>
        <tr>
          <th>Document Name</th>
          <th>Status</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
      </div>
      
      <button type="button" class="add-btn" onclick="addDocRow()">Add Document</button>
    </div>

    <div class="grid-3">
      <div>
        <label>Start Date</label>
        <input type="date" name="start_date" value="{{ work_order_detail.start_date|date:'Y-m-d' }}">
      </div>
      <div>
        <label>Completion Date</label>
        <input type="date" name="completion_date" value="{{ work_order_detail.completion_date|date:'Y-m-d' }}">
      </div>
      <div>
        <label>Estimated Hours</label>
        <input type="number" step="0.01" name="estimated_hours" 
               value="{{ work_order_detail.estimated_hours|default_if_none:'' }}">
      </div>
    </div>

    <div class="wr-ordr-tbl">
      <label>Time Logs</label>
      <div class="table-responsive">
        <table id="timeTable">
          <thead>
            <tr>
              <th>date</th>
              <th>Start Time</th>
              <th>Finish Time</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <button type="button" class="add-btn" onclick="addTimeRow()">Add Time Row</button>
    </div>

    <div class="mb-3">
      <label for="project_description">Project Description</label>
      <textarea name="project_description" id="project_description" class="form-control" rows="4">{{ work_order.project_description }}</textarea>
    </div>

    <div>
  <label>Project Images</label>

{% if work_order.images.exists %}
  <div class="wo-section">
    <div class="wo-title">EXISTING PROJECT IMAGES</div>

    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
      {% for img in work_order.images.all %}
        <div style="
          border: 1px solid #ccc;
          padding: 10px;
          width: 260px;
        ">

          <!-- Image Preview -->
          <img
            src="{{ img.image.url }}"
            alt="{{ img.name }}"
            style="width: 100%; height: auto; margin-bottom: 8px;"
          />

          <!-- Image Name -->
          <div style="margin-bottom: 6px;">
            <label style="font-size: 12px;">Image Name</label>
            <input
              type="text"
              name="existing_image_names[{{ img.id }}]"
              value="{{ img.name }}"
              class="form-control"
            />
          </div>

          <!-- Image Description -->
          <div style="margin-bottom: 6px;">
            <label style="font-size: 12px;">Description</label>
            <textarea
              name="existing_image_descriptions[{{ img.id }}]"
              class="form-control"
              rows="2"
            >{{ img.description }}</textarea>
          </div>

          <!-- Delete -->
          <label style="display: block; text-align: center; margin-top: 5px;">
            <input type="checkbox" name="delete_image_ids" value="{{ img.id }}">
            Delete
          </label>

        </div>
      {% endfor %}
    </div>
  </div>
{% else %}
  <p>No images uploaded.</p>
{% endif %}


  <!-- Upload input for multiple new images -->
  <!-- Upload New Images -->
<div class="wo-section" style="margin-top: 25px; margin-bottom: 25px;">
  <div class="wo-title">ADD NEW PROJECT IMAGES</div>

  <table class="wo-table" style="width: 100%;">
    <thead>
      <tr>
        <th>Image File</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody id="newImagesTable"></tbody>
  </table>

  <button type="button" class="add-btn" onclick="addImageRow()">
    Add Image
  </button>
</div>

  

    <button type="submit">Submit</button>
  </form>
</div>



<script>
  function addSpareRow() {
    const table = document.querySelector('#sparesTable tbody');
    const row = table.insertRow();
    row.innerHTML = `
      <td><input type="text" name="spare_name[]"></td>
      <td><input type="text" name="spare_unit[]"></td>
      <td><input type="number" name="spare_quantity[]"></td>`;
  }

  function addToolRow() {
    const table = document.querySelector('#toolsTable tbody');
    const row = table.insertRow();
    row.innerHTML = `
      <td><input type="text" name="tool_name[]"></td>
      <td><input type="number" name="tool_quantity[]"></td>`;
  }

  function addDocRow() {
    const table = document.querySelector('#docsTable tbody');
    const row = table.insertRow();
    row.innerHTML = `
      <td><input type="text" name="doc_name[]"></td>
      <td><input type="text" name="doc_status[]"></td>`;
  }
</script>

<script>
function addImageRow() {
  const table = document.getElementById("newImagesTable");

  const row = document.createElement("tr");

  row.innerHTML = `
    <td>
      <input
        type="file"
        name="project_images[]"
        accept="image/*"
        multiple
        required
      />
    </td>
    <td>
      <input
        type="text"
        name="image_names[]"
        placeholder="Image name"
        required
      />
    </td>
    <td>
      <textarea
        name="image_descriptions[]"
        rows="2"
        placeholder="Description"
      ></textarea>
    </td>
  `;

  table.appendChild(row);
}
</script>

{% endblock %}
